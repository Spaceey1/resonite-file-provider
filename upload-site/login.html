<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resonite Asset Manager - Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="js/theme.js"></script>
    <style>
        /* Hide dashboard by default */
        #dashboard-section {
            display: none;
        }
        
        /* Login page layout */
        body {
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00cec9 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        #auth-section {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: none;
        }
        
        .auth-layout {
            display: flex;
            align-items: center;
            gap: 4rem;
            max-width: 1200px;
            width: 100%;
        }
        
        .auth-container {
            max-width: 450px;
            position: relative;
            text-align: center;
        }
        
        .hero-text {
            color: white;
            text-align: left;
            flex-shrink: 0;
        }
        
        .hero-title {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            line-height: 1.1;
        }
        
        .hero-subtitle {
            font-size: 1.4rem;
            font-weight: 300;
            opacity: 0.9;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 1024px) {
            .auth-layout {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }
            
            .hero-text {
                text-align: center;
            }
            
            .hero-title {
                font-size: 3rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
            
            #auth-section {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Auth Section -->
        <section id="auth-section" class="active-section">
            <div class="container">
                <div class="auth-layout">
                    <!-- Hero Text -->
                    <div class="hero-text">
                        <h1 class="hero-title">Resonite File Provider</h1>
                        <p class="hero-subtitle">Manage and organize your VR assets with ease</p>
                    </div>
                    
                    <div class="auth-container">
                        <div style="position: absolute; top: 15px; right: 15px;">
                            <div id="theme-toggle" class="theme-toggle" title="Toggle dark mode">
                                <div class="theme-toggle-slider">
                                    <i class="theme-toggle-icon fas fa-sun"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="logo-container">
                            <div class="logo">Resonite<span>Assets</span></div>
                            <p class="tagline">Your VR assets, organized.</p>
                        </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="login">Log In</div>
                        <div class="tab" data-tab="register">Register</div>
                    </div>
                    
                    <div class="form-container login active-form">
                        <form id="login-form" action="/auth/login" method="POST">
                            <div class="input-group">
                                <label for="login-username">Username</label>
                                <div class="input-icon">
                                    <i class="fas fa-user"></i>
                                    <input type="text" id="login-username" name="username" required>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="login-password">Password</label>
                                <div class="input-icon">
                                    <i class="fas fa-lock"></i>
                                    <input type="password" id="login-password" name="password" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Log In</button>
                            <p id="login-message" class="message"></p>
                        </form>
                    </div>
                    
                    <div class="form-container register">
                        <form id="register-form" action="/auth/register" method="POST">
                            <div class="input-group">
                                <label for="register-username">Username</label>
                                <div class="input-icon">
                                    <i class="fas fa-user"></i>
                                    <input type="text" id="register-username" name="username" required>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="register-password">Password</label>
                                <div class="input-icon">
                                    <i class="fas fa-lock"></i>
                                    <input type="password" id="register-password" name="password" required>
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="register-confirm">Confirm Password</label>
                                <div class="input-icon">
                                    <i class="fas fa-lock"></i>
                                    <input type="password" id="register-confirm" required>
                                </div>
                            </div>
                            <div class="input-group" id="invite-code-group" style="display: none;">
                                <label for="register-invite-code">Invite Code</label>
                                <div class="input-icon">
                                    <i class="fas fa-ticket-alt"></i>
                                    <input type="text" id="register-invite-code" name="inviteCode" placeholder="Enter invite code">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Register</button>
                            <p id="register-message" class="message"></p>
                        </form>
                    </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <script>
    console.log("Login page loaded");
    </script>
    <script src="js/auth.js"></script>
    <script>
    console.log("Auth.js script loaded");
    // Add debug output to show auth cookie
    document.addEventListener('DOMContentLoaded', () => {
        console.log("Login page fully loaded");
        console.log("Current cookies:", document.cookie);
        
        // Check for existing auth cookie and redirect if present
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        // Try to redirect to dashboard if we have a token
        const authToken = getCookie('auth_token');
        if (authToken) {
            console.log("Found auth token, redirecting to dashboard...");
            // Add a timestamp parameter to prevent caching
            window.location.replace(`/dashboard?t=${Date.now()}`);
            return;
        }
        
        // Check for query parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('debug')) {
            console.log("Debug mode enabled");
        }
        
        // If redirected from dashboard, show debug info
        if (urlParams.has('from')) {
            console.log("Redirected from:", urlParams.get('from'));
        }
    });
    </script>
</body>
</html>
